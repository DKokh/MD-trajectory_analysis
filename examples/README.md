#  This is a collection of example recipes showing how to carry out particular tasks using MD-IFP scripts


##  Generation of the Interaction Fingerprint table for a set of MD trajectories obtained either from standard MD simulations or RAMD simulations
Most steps included in the present examples are also demonstrated in the JN IFP_generation_examples_TRAJ.ipynb
However, to analyze a large set of trajectories a simple python script is usually more useful.

This example provide a template script that, after small adjastment, can be used to generate IFPs for: 
- a single MD trajectory    
- a set of MD trajectories. 
- a set of Equilibration MD trajectories and dissociation RAMD trajectries
    
    
    
All steps are also included in IFP.py, that can be adjasted for a particualr task

1. **Prerequisite:**
    - Python 3.X and a set of python libraries
        Alteratively, one can configure environment in anaconda using: conda env create -f IFP_trajectory.yml
    - Scripts directory containing Scripts/IFP_generation.py and Scripts/Trajectories.py 
    
2. **Input data required:**
    - trajectory file (possible formats: nc,dcd, xtc, trr )
    - pdb file of the system (for example, generated from the first frame)
    - ligand pdb file
    - ligand mol2 file (not all mol2 files can be read, files generated by MOEor Maestro are fine)
         
3. **Procedure (all steps are also combined in the IFP.py script that can be adapted for a particular task )**
 
    (i) _working directory and template of trajectory names that will be searched and added to the object are defined._
    
        for example, simulated equilibration and dissociation trajectories can be stored as follows:
        >>for equilibration:
        
        my_ligand/my_equilibration/my_replica1/md1.dcd
        my_ligand/my_equilibration/my_replica2/md2.dcd
        
        >>for dissociation:
        
        my_ligand/my_RAMD/my_replica1/my_trajectory1/md1.dcd
        my_ligand/my_RAMD/my_replica1/my_trajectory2/md2.dcd
        
        my_ligand/my_RAMD/my_replica2/my_trajectory1/md1.dcd
        my_ligand/my_RAMD/my_replica2/my_trajectory2/md2.dcd
        
        >>reference pdb file for the system: 
        
        my_ligand/topology/my_ref.pdb
        
        >>mol2 and pdb files for the ligand:

        my_ligand/topology/my_ligand.pdb
        my_ligand/topology/my_ligand.mol2
  
    In this case we define input parameters as following:
    
    __________________________________
    
        DIR_all = "my_ligand/"
        eq = "my_equilibration/my_replic*"
        ramd = "my_RAMD/my_replic*"
        eq_tr ="my_trajec*/*.dcd"
        ramd_tr = "my_trajec*/*.dcd"
     __________________________________
     
     Note, that the reference pdb file for a complete system  and pdb/mol2 for a ligand are obligatory, while equilibration or RAMD trajectory can be omitted
   
    (ii)_Trajectory object is generated_, 
    
    which contains all information of equilibration and RAMD trajectories. 
    Additionally, ligand structure and chemical properties will be analized
    
     __________________________________
     
        tr = trajectories(DIR_all,namd_tmpl= eq, ramd_tmpl= ramd,ligand_pdb=lig_pdb,pdb = ref_pdb,\
                          ligand_mol2=lig_mol2,namd_traj_tmpl = eq_tr,ramd_traj_tmpl = tamd_tr)                   
      __________________________________
      
     (iii) _Defenition of a sub-system to be analyzed_ 
     
      - several possibilities are demonstrated below. 
      - Ligand will be added automatically to any chosen sub-system; 
      - by default only protein will be considered as a sub-system this makes simulations fast, but computations of water bridges will be not possible
      - Inclusion water makes simulations notably (at least several times) slower
     __________________________________
                               
        tr.sub_system = " protein  "                                              # only protein and ligand - default set
        tr.sub_system = " protein or (resname SOL HOH WAT G G3 G5 U5 C C3 MN)  "  # protein, ligand, solvent, RNA residues, and Mn ion
        tr.sub_system = " protein or (resname SOL HOH WAT )  "                    # protein, ligand, solvent, 
     __________________________________
     
   (iv) _IFP generation_ 
   
   (a) _for equilibration trajectories:_ 
      - One can define if water bridges must be computed (WB_analysis = True/False, default-False). 
        For computation of water bridges  water must be included in the sub-system in the previous step
      - number of contacts with lipids can be computed - lipid residue names are defined as a list, 
        for example: Lipids = ["PC","CHL","PA"]
      - fiest frame and stride are defined by the parameters step_analysis and start_analysis
        Saving results  in a data frame file (pkl)         
      - as an input parameter file name should be given 
      - results will be stored in a set of pandas DataFrames - individual frame for each trajectory-  tr.namd.traj.df_properties
      - a complete IFP table can be stored as a pkl file using tr.namd.IFP_save() function with a single parameter- file name
        this  function will return a complete pandas DataFrame including all trajectories
     __________________________________
     
        tr.analysis_all_namd(WB_analysis = False, Lipids = [],auxi_selection = [],step_analysis=step, start_analysis=start)  
        IFP_table = tr.namd.IFP_save(file_name)
      _________________________________
     
   (b) _for RAMD trajectories_
      - first relative residence times must be computed using the scan_ramd() function
      - then IFPs computed using the function , similar to that described above for equilibration trajectory
        parameters are the same as for the IFP generation for equilibration trajectories
     __________________________________   

        tr.ramd.scan_ramd()
        tr.analysis_all_ramd(WB_analysis = False, Lipids = [],auxi_selection = [],step_analysis=step, start_analysis=start)
        IFP_table = tr.namd.IFP_save(file_name)
        
 
